# å¤šè¯­è¨€ GitHub Pull Request æ·±åº¦åˆ†æçˆ¬è™« (Multi-Language GitHub PR Deep Analysis Crawler)

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Python è„šæœ¬ï¼Œç”¨äºä» GitHub ä¸Šçˆ¬å–æŒ‡å®šç¼–ç¨‹è¯­è¨€çš„çƒ­é—¨ä»“åº“ä¸­**å·²åˆå¹¶ (Merged)** çš„ **Pull Requests (PR)**ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ·±åº¦çš„ã€åŸºäºè¯­ä¹‰çš„åˆ†æã€‚

è¯¥è„šæœ¬ä¸ä»…èƒ½æŠ“å– PR çš„å…ƒæ•°æ®ï¼ˆå¦‚æ ‡é¢˜ã€æè¿°ã€è¯„è®ºï¼‰ï¼Œè¿˜èƒ½æ·±å…¥åˆ°æ¯ä¸€æ¬¡ **Commit** çš„ä»£ç å˜æ›´ä¸­ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æ **diff/patch** å†…å®¹ï¼Œæå–å‡ºå‡½æ•°ã€ç±»ã€ä¾èµ–åº“çš„å˜æ›´ä¿¡æ¯ã€‚æ‰€æœ‰æ•°æ®éƒ½ä»¥ç»“æ„åŒ–çš„ **JSONL** æ ¼å¼ä¿å­˜ï¼Œä¾¿äºåç»­è¿›è¡Œæ•°æ®åˆ†æã€æ¨¡å‹è®­ç»ƒæˆ–å­¦æœ¯ç ”ç©¶ã€‚

-----

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ (Core Features)

  * **å¤šè¯­è¨€æ”¯æŒ**: å¯é…ç½®çˆ¬å–å¤šç§ä¸»æµç¼–ç¨‹è¯­è¨€çš„ä»“åº“ã€‚
  * **æ·±åº¦è¯­ä¹‰åˆ†æ**:
      * **å‡½æ•°å˜æ›´æ£€æµ‹**: è¯†åˆ«åœ¨ PR ä¸­è¢«æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹çš„å‡½æ•°ã€‚
      * **ç±»/ç»“æ„ä½“å˜æ›´æ£€æµ‹**: è¯†åˆ«åœ¨ PR ä¸­è¢«æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹çš„ç±»æˆ–ç»“æ„ä½“ã€‚
      * **ä¾èµ–æå–**: è§£æä»£ç æ–‡ä»¶ï¼Œæå–å…¶å¯¼å…¥çš„ä¾èµ–åº“/æ¨¡å—ã€‚
      * **Diff Hunk è§£æ**: å°† `patch` å†…å®¹ç»“æ„åŒ–ï¼Œæ–¹ä¾¿åˆ†æå…·ä½“çš„ä»£ç è¡Œå˜æ›´ã€‚
  * **å…¨é¢çš„æ•°æ®é‡‡é›†**: è·å–åŒ…æ‹¬ PR å…ƒæ•°æ®ã€Commitsã€æ–‡ä»¶å˜æ›´ã€å®¡æŸ¥è¯„è®º (Reviews & Comments) åœ¨å†…çš„å®Œæ•´ä¿¡æ¯ã€‚
  * **å¼ºå¤§çš„å®¹é”™ä¸ç»­çˆ¬æœºåˆ¶**:
      * è‡ªåŠ¨å¤„ç† GitHub API é€Ÿç‡é™åˆ¶ (Rate Limit) å’Œç½‘ç»œé”™è¯¯ã€‚
      * èƒ½å¤Ÿè·³è¿‡å·²å¤„ç†çš„ä»“åº“ï¼Œæ”¯æŒä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­çˆ¬å–ã€‚
  * **ç»“æ„åŒ–è¾“å‡º**: æ‰€æœ‰æ•°æ®å‡ä»¥ `.jsonl` æ ¼å¼ä¿å­˜ï¼Œæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼Œæ–¹ä¾¿å¤„ç†ã€‚

-----

## âš™ï¸ æ”¯æŒçš„è¯­è¨€ (Supported Languages)

è„šæœ¬é€šè¿‡ `MultiLanguageSemanticAnalyzer` ç±»ä¸­çš„ `LANGUAGE_CONFIG` æ¥æ”¯æŒä¸åŒè¯­è¨€çš„è¯­ä¹‰åˆ†æã€‚åœ¨ `main` å‡½æ•°ä¸­çš„ `languages` åˆ—è¡¨ä¸­ï¼Œæ‚¨å¯ä»¥å¡«å…¥ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªè¯­è¨€åç§°çš„å­—ç¬¦ä¸²ï¼š

  * `'python'`
  * `'javascript'`
  * `'java'`
  * `'golang'`
  * `'cpp'`
  * `'typescript'`

**æ³¨æ„**:

  * å¯¹äº C++ï¼Œè„šæœ¬ä¼šè¯†åˆ« `.cpp`, `.cc`, `.cxx`, `.h`, `.hpp` ç­‰å¤šç§æ‰©å±•åã€‚
  * å¯¹äº Goï¼Œè„šæœ¬ä¼šæ­£ç¡®è¯†åˆ« `go` è¯­è¨€ã€‚
  * å¯¹äº JavaScript å’Œ TypeScriptï¼Œè„šæœ¬ä¼šè¯†åˆ« `.js`, `.jsx`, `.ts`, `.tsx` ç­‰æ‰©å±•åã€‚

-----

## ğŸ”§ å®‰è£…ä¸é…ç½® (Installation & Configuration)

åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ï¼š

**1. å®‰è£…ä¾èµ–åº“**

è¯¥è„šæœ¬ä¸»è¦ä¾èµ– `requests` åº“ã€‚æ‚¨å¯ä»¥é€šè¿‡ pip å®‰è£…ï¼š

```bash
pip install requests
```

**2. è·å– GitHub Personal Access Token**

ä¸ºäº†è®¿é—® GitHub API å¹¶è·å¾—æ›´é«˜çš„é€Ÿç‡é™åˆ¶ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª Personal Access Token (PAT)ã€‚

  * è®¿é—® GitHub [**è®¾ç½® -\> Developer settings -\> Personal access tokens**](https://github.com/settings/tokens) æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Tokenã€‚
  * ç¡®ä¿æˆäºˆ `repo` å’Œ `read:org` æƒé™ï¼Œä»¥ä¾¿èƒ½å¤Ÿè®¿é—®å…¬å…±ä»“åº“çš„è¯¦ç»†ä¿¡æ¯ã€‚

**3. åˆ›å»º `.env` æ–‡ä»¶**

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `.env` çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ç”¨äºå­˜æ”¾æ‚¨çš„ GitHub Tokenï¼Œä»¥é¿å…ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ã€‚æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```
GITHUB_TOKEN=ghp_YourPersonalAccessTokenHere
```

è¯·å°† `ghp_YourPersonalAccessTokenHere` æ›¿æ¢ä¸ºæ‚¨è‡ªå·±ç”Ÿæˆçš„ Tokenã€‚

**4. å‡†å¤‡ä»“åº“åˆ—è¡¨æ–‡ä»¶**

è„šæœ¬éœ€è¦ä»æœ¬åœ°æ–‡ä»¶ä¸­è¯»å–è¦çˆ¬å–çš„ä»“åº“åˆ—è¡¨ã€‚

  * è¯·ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªåä¸º `top_2000_star_repos_this_year` çš„æ–‡ä»¶å¤¹ã€‚
  * åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œå­˜æ”¾ä»¥ `{language}_stars_this_year.jsonl` æ ¼å¼å‘½åçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ `top_javascript_stars_this_year.jsonl`ã€‚
  * è¿™äº›æ–‡ä»¶åº”è¯¥æ˜¯ JSONL æ ¼å¼ï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªä»“åº“ä¿¡æ¯çš„ JSON å¯¹è±¡ï¼Œè‡³å°‘éœ€è¦åŒ…å« `repo_name` (å¦‚ `facebook/react`) å’Œ `star_count` å­—æ®µã€‚

-----

## â–¶ï¸ å¦‚ä½•è¿è¡Œ (How to Run)

1.  **é…ç½®çˆ¬å–ç›®æ ‡**:
    æ‰“å¼€ `crawler.py` æ–‡ä»¶ï¼Œæ‰¾åˆ°æ–‡ä»¶åº•éƒ¨çš„ `main` å‡½æ•°ã€‚

      * åœ¨ `languages` åˆ—è¡¨ä¸­è®¾ç½®æ‚¨æƒ³è¦çˆ¬å–çš„è¯­è¨€ã€‚
        ```python
        # ç¤ºä¾‹ï¼šåŒæ—¶çˆ¬å– JavaScript å’Œ Python çš„æ•°æ®
        languages = [
            'javascript',
            'python'
        ]
        ```
      * æ‚¨å¯ä»¥è®¾ç½® `target_repos_per_language` æ¥æŒ‡å®šæ¯ç§è¯­è¨€è¦æˆåŠŸå¤„ç†çš„ä»“åº“æ•°é‡ã€‚

2.  **æ‰§è¡Œè„šæœ¬**:
    åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œå¯¼èˆªåˆ°é¡¹ç›®æ ¹ç›®å½•å¹¶è¿è¡Œè„šæœ¬ï¼š

    ```bash
    python crawler.py
    ```

è„šæœ¬ä¼šå¼€å§‹è¿è¡Œï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­æ‰“å°è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰å¤„ç†çš„ä»“åº“ã€PR è¿›åº¦ä»¥åŠ API é€Ÿç‡é™åˆ¶ç­‰ã€‚

-----

## ğŸ“Š è¾“å‡ºæ•°æ®ç»“æ„ (Output Data Structure)

æ‰€æœ‰çˆ¬å–å’Œåˆ†æçš„æ•°æ®éƒ½å°†ä¿å­˜åœ¨ `github_pr_data` æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶æŒ‰è¯­è¨€å’Œæ•°æ®ç±»å‹åˆ†ç±»å‘½åã€‚

  * `{language}_pr_data.jsonl`: PR çš„æ ¸å¿ƒå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€ä½œè€…ã€ç»Ÿè®¡ä¿¡æ¯ï¼ˆä»£ç å¢åˆ ã€æ–‡ä»¶å˜æ›´æ•°ç­‰ï¼‰ã€‚
  * `{language}_commits.jsonl`: æ¯ä¸ª PR åŒ…å«çš„æ‰€æœ‰ commit çš„è¯¦ç»†ä¿¡æ¯ã€‚
  * `{language}_file_changes.jsonl`: æ¯æ¬¡ commit ä¸­æ¶‰åŠçš„æ–‡ä»¶å˜æ›´åˆ—è¡¨ï¼ŒåŒ…å« `patch` å†…å®¹ã€‚
  * `{language}_review_comments.jsonl`: PR é¡µé¢ä¸Šçš„æ‰€æœ‰å®¡æŸ¥è¯„è®ºå’Œä»£ç è¡Œè¯„è®ºã€‚
  * `{language}_function_changes.jsonl`: ä» `patch` ä¸­æå–åˆ°çš„**å‡½æ•°å˜æ›´**çš„è¯¦ç»†ä¿¡æ¯ã€‚
  * `{language}_class_changes.jsonl`: ä» `patch` ä¸­æå–åˆ°çš„**ç±»/ç»“æ„ä½“å˜æ›´**çš„è¯¦ç»†ä¿¡æ¯ã€‚
  * `{language}_imports.jsonl`: ä»å˜æ›´çš„æ–‡ä»¶ä¸­æå–åˆ°çš„**ä¾èµ–å¯¼å…¥**è¯­å¥ã€‚
  * `{language}_diff_hunks.jsonl`: `patch` å†…å®¹è¢«ç»“æ„åŒ–è§£æåçš„æ•°æ®å— (Hunks)ã€‚

-----

## ğŸ—ƒï¸ æ•°æ®å…¥åº“ï¼šä» JSONL åˆ° SQLite

ä¸ºäº†æ›´é«˜æ•ˆåœ°æŸ¥è¯¢å’Œåˆ†ææ•°æ®ï¼Œé¡¹ç›®æä¾›äº† `jsonl_to_sqlite.py` è„šæœ¬ï¼Œå¯ä»¥å°† `github_pr_data` ç›®å½•ä¸­æ‰€æœ‰æŒ‰è¯­è¨€åˆ†ç±»çš„ `.jsonl` æ–‡ä»¶å¯¼å…¥åˆ°ä¸€ä¸ªå…³ç³»å‹çš„ SQLite æ•°æ®åº“ä¸­ã€‚

### åŠŸèƒ½

  * **è‡ªåŠ¨å»ºè¡¨**: è„šæœ¬ä¼šæ ¹æ®é¢„è®¾çš„è¡¨ç»“æ„è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œæ‰€æœ‰è¡¨ã€‚
  * **å…³ç³»æ˜ å°„**: å°†ç¦»æ•£çš„ JSONL æ•°æ®è½¬æ¢ä¸ºè§„èŒƒåŒ–çš„å…³ç³»æ•°æ®ï¼Œé€šè¿‡å¤–é”®å…³è”ï¼Œæ–¹ä¾¿è¿›è¡Œå¤æ‚çš„ JOIN æŸ¥è¯¢ã€‚
  * **æ•°æ®å»é‡**: è‡ªåŠ¨å¤„ç†é‡å¤çš„ä»“åº“ã€PRå’ŒCommitï¼Œç¡®ä¿æ•°æ®å”¯ä¸€æ€§ã€‚
  * **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ—¥å¿—è®°å½•è½¬æ¢è¿‡ç¨‹ï¼Œä¾¿äºè¿½è¸ªã€‚

### å¦‚ä½•ä½¿ç”¨

1.  **ç¡®è®¤æ•°æ®æº**: ç¡®ä¿ `github_pr_data` ç›®å½•ä¸­å·²ç»å­˜åœ¨ç”± `crawler.py` ç”Ÿæˆçš„ `.jsonl` æ–‡ä»¶ã€‚
2.  **é…ç½®ç›®æ ‡è¯­è¨€**: æ‰“å¼€ `jsonl_to_sqlite.py` æ–‡ä»¶ï¼Œåœ¨åº•éƒ¨çš„ `main` å‡½æ•°ä¸­ï¼Œä¿®æ”¹ `languages` åˆ—è¡¨ï¼ŒæŒ‡å®šéœ€è¦å¯¼å…¥æ•°æ®åº“çš„è¯­è¨€ã€‚
    ```python
    # ç¤ºä¾‹: åªå°†pythonç›¸å…³çš„æ•°æ®å¯¼å…¥æ•°æ®åº“
    languages = ['python']
    ```
3.  **è¿è¡Œè½¬æ¢è„šæœ¬**:
    ```bash
    python jsonl_to_sqlite.py
    ```

è¿è¡Œç»“æŸåï¼Œé¡¹ç›®æ ¹ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªåä¸º `github_pr_data.db` çš„ SQLite æ•°æ®åº“æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½• SQLite å¯è§†åŒ–å·¥å…·ï¼ˆå¦‚ DBeaver, DB Browser for SQLiteï¼‰æ¥æŸ¥çœ‹å’Œåˆ†æå®ƒã€‚

-----

## ğŸ›ï¸ æ•°æ®åº“è¡¨ç»“æ„ (Database Schema)

`jsonl_to_sqlite.py` è„šæœ¬åˆ›å»ºçš„æ•°æ®åº“åŒ…å«ä»¥ä¸‹æ ¸å¿ƒè¡¨æ ¼ï¼Œå®ƒä»¬é€šè¿‡ `id` å’Œ `*_id` å­—æ®µç›¸äº’å…³è”ï¼š

1.  **`repositories`**

      * å­˜å‚¨ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ã€‚
      * `id`, `owner`, `name`, `full_name` (å”¯ä¸€), `language`, `stars`, `url`, `created_at`

2.  **`pull_requests`**

      * å­˜å‚¨ PR çš„å…ƒæ•°æ®ã€‚
      * å…³è”åˆ° `repositories` è¡¨ã€‚
      * `id`, `repo_id` (å¤–é”®), `pr_number`, `title`, `body`, `author`, `state`, `created_at`, `merged_at`, `additions`, `deletions`, `changed_files`, `commits_count`, `review_comments_count`

3.  **`commits`**

      * å­˜å‚¨ PR ä¸­çš„æ¯ä¸€æ¬¡ commitã€‚
      * å…³è”åˆ° `pull_requests` å’Œ `repositories` è¡¨ã€‚
      * `id`, `repo_id` (å¤–é”®), `pr_id` (å¤–é”®), `commit_hash` (å”¯ä¸€), `message`, `author`, `committed_at`

4.  **`file_changes`**

      * è®°å½•æ¯æ¬¡ commit ä¸­å‘ç”Ÿäº†å˜æ›´çš„æ–‡ä»¶ã€‚
      * å…³è”åˆ° `commits` è¡¨ã€‚
      * `id`, `commit_id` (å¤–é”®), `file_path`, `change_type` ('added', 'modified', 'deleted'), `file_language`, `additions`, `deletions`, `patch_content`

5.  **`function_changes` & `class_changes`**

      * è®°å½•ä»£ç ä¸­å‡½æ•°å’Œç±»çš„å…·ä½“å˜æ›´ã€‚
      * å…³è”åˆ° `file_changes` è¡¨ã€‚
      * `id`, `file_change_id` (å¤–é”®), `function_name`/`class_name`, `change_type` ('added', 'removed'), `line_content`

6.  **`diff_hunks`**

      * ç»“æ„åŒ–å­˜å‚¨ `patch` å†…å®¹çš„æ•°æ®å—ã€‚
      * å…³è”åˆ° `file_changes` è¡¨ã€‚
      * `id`, `file_change_id` (å¤–é”®), `hunk_index`, `old_start`, `old_count`, `new_start`, `new_count`, `context`, `content`

7.  **`file_imports`**

      * è®°å½•æ–‡ä»¶ä¸­æå–å‡ºçš„ä¾èµ–å¯¼å…¥è¯­å¥ã€‚
      * å…³è”åˆ° `file_changes` è¡¨ã€‚
      * `id`, `file_change_id` (å¤–é”®), `import_statement`, `module_name`, `imported_items`

8.  **`review_comments`**

      * è®°å½• PR çš„æ‰€æœ‰å®¡æŸ¥è¯„è®ºã€‚
      * å…³è”åˆ° `pull_requests` è¡¨ã€‚
      * `id`, `pr_id` (å¤–é”®), `comment_type`, `reviewer`, `comment_text`, `file_path`, `line_number`, `created_at`